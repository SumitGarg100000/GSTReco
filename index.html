<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TDS Calculator for FY 2025-26/AY 2026-27 aligned with Form 16.">
    <title>TDS on Salary Calculator - FY 2025-26</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #0e4377;
            --secondary-color: #1a73e8;
            --text-light: #FFFFFF;
            --text-dark: #2C3E50;
            --table-header: #1a73e8;
            --table-row-alt: #F8F9FA;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            line-height: 1.6;
            background-color: #f0f8ff;
            color: var(--text-dark);
            padding-bottom: 2rem;
        }
        header {
            background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            padding: 2rem;
            text-align: center;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card-header {
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #1a73e8;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #f5f9ff;
        }
        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            border-color: #0d47a1;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }
        .button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(145deg, #1a73e8, #0d47a1);
            color: white;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -0.5rem;
        }
        .col {
            padding: 0 0.5rem;
            flex: 1;
            min-width: 250px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
        }
        .result-table th,
        .result-table td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid #E0E0E0;
        }
        .result-table th {
            background-color: var(--table-header);
            color: white;
            font-size: 0.85rem;
        }
        .result-table tr:nth-child(even) {
            background-color: var(--table-row-alt);
        }
        .summary-box {
            background: linear-gradient(145deg, #1a73e8, #0d47a1);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        .chart-container {
            height: 300px;
            margin: 2rem 0;
        }
        footer {
            background: linear-gradient(145deg, #0e4377, #1a5fb4);
            color: var(--text-light);
            padding: 1.5rem;
            text-align: center;
        }
        @media (max-width: 768px) {
            .col { flex: 100%; }
            .button { width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <h1>TDS on Salary Calculator</h1>
        <h2>FY 2025-26 (AY 2026-27)</h2>
        <div class="container">
            <button class="button" onclick="resetValues()">Reset</button>
            <button class="button" onclick="printAsPDF()">Print as PDF</button>
        </div>
    </header>

    <div class="container">
        <!-- Basic Details -->
        <div class="card">
            <div class="card-header"><h3>Basic Details</h3></div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="employee_name">Name</label>
                        <input type="text" id="employee_name" placeholder="Enter employee name">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="pan_number">PAN Number</label>
                        <input type="text" id="pan_number" placeholder="Enter PAN number">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="employee_age">Age</label>
                        <input type="number" id="employee_age" placeholder="Enter age" min="18" value="30">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tax_scheme">Tax Regime</label>
                        <select id="tax_scheme">
                            <option value="new">New Tax Regime (Default)</option>
                            <option value="old">Old Tax Regime</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Salary Details (Annual) -->
        <div class="card">
            <div class="card-header"><h3>Salary Income (Annual)</h3></div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="basic_salary">Basic Salary</label>
                        <input type="number" id="basicsalary" placeholder="Enter basic salary" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="hra_salary">HRA</label>
                        <input type="number" id="hra" placeholder="Enter HRA" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="bonus_incentive">Bonus/Incentive</label>
                        <input type="number" id="bonus" placeholder="Enter bonus" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="special_allowance">Special Allowance</label>
                        <input type="number" id="specialallowance" placeholder="Enter special allowance" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="otherallowance">Other Allowance</label>
                        <input type="number" id="other_allowance" placeholder="Enter other allowance" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="hra_exemption">HRA Exemption u/s 10(13A)</label>
                        <input type="number" id="exemptionsec13a" placeholder="Enter HRA exemption amount" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="exempt_allowance">Exempt Allowance (e.g., Conveyance)</label>
                        <input type="number" id="otherexemption" placeholder="Enter exempt allowance" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="professional_tax">Professional Tax Paid</label>
                        <input type="number" id="professionaltax" placeholder="Enter professional tax" min="0" value="2400">
                    </div>
                </div>
            </div>
        </div>

        <!-- House Property -->
        <div class="card">
            <div class="card-header"><h3>House Property</h3></div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="property_type">Property Type</label>
                        <select id="property_type">
                            <option value="self-occupied">Self-Occupied</option>
                            <option value="let-out">Let-Out</option>
                        </select>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="interestself">Interest on Housing Loan(Self-occupied)</label>
                        <input type="number" id="interestself" placeholder="Enter interest (max 2 lakh)" min="0">
                   <label for="interestletout">Interest on Housing Loan(Let out)</label>
                        <input type="number" id="interestletout" placeholder="Enter interest (max 2 lakh)" min="0">
                   
                    </div>
                </div>
            </div>
        </div>

        <!-- Other Income -->
        <div class="card">
            <div class="card-header"><h3>Income from Other Sources</h3></div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="other_income">Other Income (e.g., Interest, Dividends)</label>
                        <input type="number" id="otherincome" placeholder="Enter other income" min="0">
                    </div>
                </div>
            </div>
        </div>

        <!-- Deductions (Old Regime) -->
        <div class="card" id="old-regime-deductions" style="display: none;">
            <div class="card-header"><h3>Deductions (Old Tax Regime)</h3></div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="section_80c">Section 80C Investments</label>
                        <input type="number" id="deduction80c" placeholder="Max 1.5 lakh (combined)" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="section_80ccc">Section 80CCC (Pension Plans)</label>
                        <input type="number" id="deduction80ccc" placeholder="Max 1.5 lakh (combined)" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="section_80ccd1">Section 80CCD(1) (NPS Employee)</label>
                        <input type="number" id="deduction80ccd1" placeholder="Max 1.5 lakh (combined)" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="section_80ccd1b">Section 80CCD(1B) (Additional NPS)</label>
                        <input type="number" id="deduction80ccd1b" placeholder="Max 50,000" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="section_80ccd2">Section 80CCD(2) (NPS Employer)</label>
                        <input type="number" id="deduction80ccd2" placeholder="Max 10% of salary" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="section_80d">Section 80D (Health Insurance)</label>
                        <input type="number" id="deduction80d" placeholder="Max 25,000/50,000" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="section_80e">Section 80E (Education Loan Interest)</label>
                        <input type="number" id="deduction80e" placeholder="Enter education loan interest" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="section_80g">Section 80G (Donations)</label>
                        <input type="number" id="deduction80g" placeholder="Enter donation amount" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="section_80tta">Section 80TTA/80TTB (Savings Interest)</label>
                        <input type="number" id="deduction80tta" placeholder="Max 10,000/50,000" min="0">
                    </div>
                </div>
            </div>
        </div>

        <!-- Month-Wise TDS Deducted -->
        <div class="card">
            <div class="card-header"><h3>Month-Wise TDS Deducted</h3></div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="tds_apr">April</label>
                        <input type="number" id="tds_apr" placeholder="Enter April TDS" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tds_may">May</label>
                        <input type="number" id="tds_may" placeholder="Enter May TDS" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="tds_jun">June</label>
                        <input type="number" id="tds_jun" placeholder="Enter June TDS" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tds_jul">July</label>
                        <input type="number" id="tds_jul" placeholder="Enter July TDS" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="tds_aug">August</label>
                        <input type="number" id="tds_aug" placeholder="Enter August TDS" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tds_sep">September</label>
                        <input type="number" id="tds_sep" placeholder="Enter September TDS" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="tds_oct">October</label>
                        <input type="number" id="tds_oct" placeholder="Enter October TDS" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tds_nov">November</label>
                        <input type="number" id="tds_nov" placeholder="Enter November TDS" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="tds_dec">December</label>
                        <input type="number" id="tds_dec" placeholder="Enter December TDS" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tds_jan">January</label>
                        <input type="number" id="tds_jan" placeholder="Enter January TDS" min="0">
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="col">
                    <div class="form-group">
                        <label for="tds_feb">February</label>
                        <input type="number" id="tds_feb" placeholder="Enter February TDS" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="tds_mar">March</label>
                        <input type="number" id="tds_mar" placeholder="Enter March TDS" min="0">
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="text-center my-8">
            <button id="calculate-btn" class="button" onclick="calculateTDS()">Calculate TDS</button>
        </div>

        <!-- Results Section -->
        <div class="card" id="results-section" style="display: none;">
            <div class="card-header"><h3>TDS Calculation Results</h3></div>
            <h4 class="text-xl font-semibold mb-4 text-gray-700">Income Breakup</h4>
            <table class="result-table mb-6">
                <thead><tr><th>Particulars</th><th>Amount (₹)</th></tr></thead>
                <tbody>
                    <tr><td>Basic Salary</td><td id="basic_salary_result">0</td></tr>
                    <tr><td>HRA</td><td id="hra_result">0</td></tr>
                    <tr><td>Bonus/Incentive</td><td id="bonus_result">0</td></tr>
                    <tr><td>Special Allowance</td><td id="special_allowance_result">0</td></tr>
                    <tr><td>Other Allowance</td><td id="other_allowance_result">0</td></tr>
                    <tr><td><strong>Gross Salary</strong></td><td id="gross_salary" class="font-bold">0</td></tr>
                    <tr><td>HRA Exemption u/s 10(13A)</td><td id="hra_exemption_result">0</td></tr>
                    <tr><td>Exempt Allowance</td><td id="exempt_allowance_result">0</td></tr>
                    <tr><td>Professional Tax Paid</td><td id="professional_tax_result">0</td></tr>
                    <tr><td>Standard Deduction</td><td id="standard_deduction">0</td></tr>
                    <tr><td><strong>Total Exemptions & Deductions</strong></td><td id="total_exemptions" class="font-bold">0</td></tr>
                    <tr><td><strong>Net Salary Income</strong></td><td id="net_salary" class="font-bold">0</td></tr>
                    <tr><td>Loss from House Property (Interest)</td><td id="housing_loan_interest_result">0</td></tr>
                    <tr><td>Income from Other Sources</td><td id="other_income_result">0</td></tr>
                    <tr><td><strong>Gross Total Income</strong></td><td id="gross_total_income" class="font-bold">0</td></tr>
                </tbody>
            </table>
            <h4 class="text-xl font-semibold mb-4 text-gray-700">Deductions (Old Regime)</h4>
            <table class="result-table mb-6">
                <thead><tr><th>Particulars</th><th>Amount (₹)</th></tr></thead>
                <tbody>
                    <tr><td>Section 80C</td><td id="section_80c_result">0</td></tr>
                    <tr><td>Section 80CCC</td><td id="section_80ccc_result">0</td></tr>
                    <tr><td>Section 80CCD(1)</td><td id="section_80ccd1_result">0</td></tr>
                    <tr><td>Section 80CCD(1B)</td><td id="section_80ccd1b_result">0</td></tr>
                    <tr><td>Section 80CCD(2)</td><td id="section_80ccd2_result">0</td></tr>
                    <tr><td>Section 80D</td><td id="section_80d_result">0</td></tr>
                    <tr><td>Section 80E</td><td id="section_80e_result">0</td></tr>
                    <tr><td>Section 80G</td><td id="section_80g_result">0</td></tr>
                    <tr><td>Section 80TTA/80TTB</td><td id="section_80tta_result">0</td></tr>
                    <tr><td><strong>Total Deductions</strong></td><td id="total_deductions" class="font-bold">0</td></tr>
                </tbody>
            </table>
            <h4 class="text-xl font-semibold mb-4 text-gray-700">Tax Calculation</h4>
            <table class="result-table mb-6">
                <thead><tr><th>Particulars</th><th>Amount (₹)</th></tr></thead>
                <tbody>
                    <tr><td>Gross Total Income</td><td id="gross_income_tax">0</td></tr>
                    <tr><td>Total Deductions (Old Regime)</td><td id="total_deductions_tax">0</td></tr>
                    <tr><td><strong>Net Taxable Income</strong></td><td id="net_taxable_income" class="font-bold">0</td></tr>
                    <tr><td>Income Tax</td><td id="income_tax">0</td></tr>
                    <tr><td>Rebate u/s 87A</td><td id="rebate">0</td></tr>
                    <tr><td>Surcharge</td><td id="surcharge">0</td></tr>
                    <tr><td>Tax After Rebate & Surcharge</td><td id="tax_after_rebate">0</td></tr>
                    <tr><td>Health & Education Cess (4%)</td><td id="cess">0</td></tr>
                    <tr><td>Prior TDS Deducted</td><td id="prior_tds_result">0</td></tr>
                    <tr><td><strong>Remaining Annual Tax Liability</strong></td><td id="annual_tax_liability" class="font-bold">0</td></tr>
                </tbody>
            </table>
            <h4 class="text-xl font-semibold mb-4 text-gray-700">Monthly TDS Breakdown</h4>
            <div class="chart-container">
                <canvas id="tds-chart"></canvas>
            </div>
            <table class="result-table mb-6">
                <thead><tr><th>Month</th><th>TDS Deducted (₹)</th><th>TDS Liability (₹)</th></tr></thead>
                <tbody id="monthly_tds_table"></tbody>
            </table>
            <div class="summary-box">
                <h3>Average Monthly TDS (Remaining Months)</h3>
                <div class="amount" id="monthly_tds_amount">₹ 0</div>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2025 TDS Calculator. All rights reserved.</p>
    </footer>

    <script>
        // Initialize form
        window.onload = function() {
            document.getElementById('professional_tax').value = 2400;
            document.getElementById('tax_scheme').value = 'new';
            document.getElementById('old-regime-deductions').style.display = 'none';
            document.getElementById('hra_exemption').disabled = true;
            document.getElementById('hra_exemption').value = 0;
            document.getElementById('employee_age').value = 30;
        };

        // Toggle old regime deductions and HRA exemption
        document.getElementById('tax_scheme').addEventListener('change', function() {
            const oldRegimeDeductions = document.getElementById('old-regime-deductions');
            const hraExemptionField = document.getElementById('hra_exemption');
            if (this.value === 'old') {
                oldRegimeDeductions.style.display = 'block';
                hraExemptionField.disabled = false;
            } else {
                oldRegimeDeductions.style.display = 'none';
                hraExemptionField.disabled = true;
                hraExemptionField.value = 0;
            }
        });

        // Reset form
        function resetValues() {
            document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => input.value = '');
            document.getElementById('tax_scheme').value = 'new';
            document.getElementById('property_type').value = 'self-occupied';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('professional_tax').value = 2400;
            document.getElementById('old-regime-deductions').style.display = 'none';
            document.getElementById('hra_exemption').disabled = true;
            document.getElementById('hra_exemption').value = 0;
            document.getElementById('employee_age').value = 30;
        }

        // Print as PDF
        function printAsPDF() {
            window.print();
        }

        // Tax calculation functions
        function calculateOldRegimeTax(income, age) {
            let tax = 0, rebate = 0;
            if (age < 60) {
                if (income <= 250000) tax = 0;
                else if (income <= 500000) tax = (income - 250000) * 0.05;
                else if (income <= 1000000) tax = 12500 + (income - 500000) * 0.2;
                else tax = 112500 + (income - 1000000) * 0.3;
                if (income <= 500000) rebate = Math.min(tax, 12500);
            } else if (age >= 60 && age < 80) {
                if (income <= 300000) tax = 0;
                else if (income <= 500000) tax = (income - 300000) * 0.05;
                else if (income <= 1000000) tax = 10000 + (income - 500000) * 0.2;
                else tax = 110000 + (income - 1000000) * 0.3;
                if (income <= 500000) rebate = Math.min(tax, 12500);
            } else {
                if (income <= 500000) tax = 0;
                else if (income <= 1000000) tax = (income - 500000) * 0.2;
                else tax = 100000 + (income - 1000000) * 0.3;
                if (income <= 500000) rebate = Math.min(tax, 12500);
            }
            return { tax: Math.max(0, tax - rebate), rebate };
        }

        function calculateNewRegimeTax(income) {
            let tax = 0, rebate = 0;
            if (income <= 300000) tax = 0;
            else if (income <= 700000) tax = (income - 300000) * 0.05;
            else if (income <= 1000000) tax = 20000 + (income - 700000) * 0.1;
            else if (income <= 1200000) tax = 50000 + (income - 1000000) * 0.15;
            else if (income <= 1500000) tax = 80000 + (income - 1200000) * 0.2;
            else tax = 140000 + (income - 1500000) * 0.3;
            if (income <= 700000) rebate = Math.min(tax, 25000);
            return { tax: Math.max(0, tax - rebate), rebate };
        }

        function calculateSurcharge(tax, income) {
            if (income > 5000000 && income <= 10000000) return tax * 0.1;
            if (income > 10000000 && income <= 20000000) return tax * 0.15;
            if (income > 20000000) return tax * 0.25;
            return 0;
        }

        // Calculate TDS
        function calculateTDS() {
            try {
                // Get and validate inputs
                const inputs = {
                    taxRegime: document.getElementById('tax_scheme').value,
                    basicSalary: Math.max(0, parseFloat(document.getElementById('basic_salary').value) || 0),
                    hra: Math.max(0, parseFloat(document.getElementById('hra_salary').value) || 0),
                    bonus: Math.max(0, parseFloat(document.getElementById('bonus_incentive').value) || 0),
                    specialAllowance: Math.max(0, parseFloat(document.getElementById('special_allowance').value) || 0),
                    otherAllowance: Math.max(0, parseFloat(document.getElementById('other_allowance').value) || 0),
                    hraExemption: Math.max(0, parseFloat(document.getElementById('hra_exemption').value) || 0),
                    exemptAllowance: Math.max(0, parseFloat(document.getElementById('exempt_allowance').value) || 0),
                    professionalTax: Math.max(0, parseFloat(document.getElementById('professional_tax').value) || 0),
                    housingLoanInterest: Math.max(0, parseFloat(document.getElementById('housing_loan_interest').value) || 0),
                    otherIncome: Math.max(0, parseFloat(document.getElementById('other_income').value) || 0),
                    age: Math.max(18, parseInt(document.getElementById('employee_age').value) || 18),
                    section80C: Math.max(0, parseFloat(document.getElementById('section_80c').value) || 0),
                    section80CCC: Math.max(0, parseFloat(document.getElementById('section_80ccc').value) || 0),
                    section80CCD1: Math.max(0, parseFloat(document.getElementById('section_80ccd1').value) || 0),
                    section80CCD1B: Math.max(0, parseFloat(document.getElementById('section_80ccd1b').value) || 0),
                    section80CCD2: Math.max(0, parseFloat(document.getElementById('section_80ccd2').value) || 0),
                    section80D: Math.max(0, parseFloat(document.getElementById('section_80d').value) || 0),
                    section80E: Math.max(0, parseFloat(document.getElementById('section_80e').value) || 0),
                    section80G: Math.max(0, parseFloat(document.getElementById('section_80g').value) || 0),
                    section80TTA: Math.max(0, parseFloat(document.getElementById('section_80tta').value) || 0),
                    tdsDeducted: [
                        Math.max(0, parseFloat(document.getElementById('tds_apr').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_may').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_jun').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_jul').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_aug').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_sep').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_oct').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_nov').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_dec').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_jan').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_feb').value) || 0),
                        Math.max(0, parseFloat(document.getElementById('tds_mar').value) || 0)
                    ]
                };

                // Validate inputs
                for (let key in inputs) {
                    if (key !== 'taxRegime' && key !== 'tdsDeducted' && (isNaN(inputs[key]) || inputs[key] < 0)) {
                        throw new Error(`Invalid input for ${key}`);
                    }
                }
                if (inputs.tdsDeducted.some(val => isNaN(val) || val < 0)) {
                    throw new Error('Invalid TDS deducted values');
                }

                // Calculations
                const totalTdsDeducted = inputs.tdsDeducted.reduce((sum, val) => sum + val, 0);
                const grossSalary = inputs.basicSalary + inputs.hra + inputs.bonus + inputs.specialAllowance + inputs.otherAllowance;
                const standardDeduction = inputs.taxRegime === 'new' ? 75000 : 50000;
                const hraExemption = inputs.taxRegime === 'old' ? inputs.hraExemption : 0;
                const totalExemptions = hraExemption + inputs.exemptAllowance + inputs.professionalTax + standardDeduction;
                const netSalaryIncome = Math.max(0, grossSalary - totalExemptions);
                const housingLoanInterest = Math.min(inputs.housingLoanInterest, 200000);
                const grossTotalIncome = Math.max(0, netSalaryIncome - housingLoanInterest + inputs.otherIncome);

                // Deductions (Old Regime)
                let deductions = {
                    combined80C: 0,
                    section80CCD1B: 0,
                    section80CCD2: 0,
                    section80D: 0,
                    section80E: 0,
                    section80G: 0,
                    section80TTA: 0
                };
                if (inputs.taxRegime === 'old') {
                    deductions.combined80C = Math.min(inputs.section80C + inputs.section80CCC + inputs.section80CCD1, 150000);
                    deductions.section80CCD1B = Math.min(inputs.section80CCD1B, 50000);
                    deductions.section80CCD2 = Math.min(inputs.section80CCD2, inputs.basicSalary * 0.1);
                    deductions.section80D = Math.min(inputs.section80D, inputs.age >= 60 ? 50000 : 25000);
                    deductions.section80TTA = Math.min(inputs.section80TTA, inputs.age >= 60 ? 50000 : 10000);
                    deductions.section80E = inputs.section80E;
                    deductions.section80G = inputs.section80G;
                }
                const totalDeductions = Object.values(deductions).reduce((sum, val) => sum + val, 0);
                const netTaxableIncome = Math.max(0, grossTotalIncome - totalDeductions);

                // Tax calculation
                let taxResult = inputs.taxRegime === 'old'
                    ? calculateOldRegimeTax(netTaxableIncome, inputs.age)
                    : calculateNewRegimeTax(netTaxableIncome);
                let incomeTax = taxResult.tax;
                const rebate = taxResult.rebate;
                const surcharge = calculateSurcharge(incomeTax, netTaxableIncome);
                const taxAfterSurcharge = incomeTax + surcharge;
                const cess = taxAfterSurcharge * 0.04;
                const totalTax = taxAfterSurcharge + cess;
                const annualTaxLiability = Math.max(0, totalTax - totalTdsDeducted);
                const monthsWithNoTDS = inputs.tdsDeducted.reduce((count, val) => count + (val === 0 ? 1 : 0), 0);
                const monthlyTDS = monthsWithNoTDS > 0 ? annualTaxLiability / monthsWithNoTDS : 0;

                // Display results
                const displayFields = {
                    basic_salary_result: inputs.basicSalary,
                    hra_result: inputs.hra,
                    bonus_result: inputs.bonus,
                    special_allowance_result: inputs.specialAllowance,
                    other_allowance_result: inputs.otherAllowance,
                    gross_salary: grossSalary,
                    hra_exemption_result: hraExemption,
                    exempt_allowance_result: inputs.exemptAllowance,
                    professional_tax_result: inputs.professionalTax,
                    standard_deduction: standardDeduction,
                    total_exemptions: totalExemptions,
                    net_salary: netSalaryIncome,
                    housing_loan_interest_result: housingLoanInterest,
                    other_income_result: inputs.otherIncome,
                    gross_total_income: grossTotalIncome,
                    section_80c_result: inputs.section80C,
                    section_80ccc_result: inputs.section80CCC,
                    section_80ccd1_result: inputs.section80CCD1,
                    section_80ccd1b_result: deductions.section80CCD1B,
                    section_80ccd2_result: deductions.section80CCD2,
                    section_80d_result: deductions.section80D,
                    section_80e_result: deductions.section80E,
                    section_80g_result: deductions.section80G,
                    section_80tta_result: deductions.section80TTA,
                    total_deductions: totalDeductions,
                    gross_income_tax: grossTotalIncome,
                    total_deductions_tax: totalDeductions,
                    net_taxable_income: netTaxableIncome,
                    income_tax: incomeTax,
                    rebate: rebate,
                    surcharge: surcharge,
                    tax_after_rebate: taxAfterSurcharge,
                    cess: cess,
                    prior_tds_result: totalTdsDeducted,
                    annual_tax_liability: annualTaxLiability,
                    monthly_tds_amount: `₹ ${formatCurrency(monthlyTDS)}`
                };
                for (let id in displayFields) {
                    document.getElementById(id).textContent = typeof displayFields[id] === 'number' ? formatCurrency(displayFields[id]) : displayFields[id];
                }

                // Generate monthly TDS table and chart
                generateMonthlyTDSTable(annualTaxLiability, inputs.tdsDeducted, monthlyTDS);
                generateTDSChart(annualTaxLiability, inputs.tdsDeducted, monthlyTDS);

                // Show results
                document.getElementById('results-section').style.display = 'block';
                document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error in calculateTDS:', error);
                alert(`Error: ${error.message}. Please ensure all inputs are valid and non-negative.`);
            }
        }

        // Generate Monthly TDS Table
        function generateMonthlyTDSTable(annualTaxLiability, tdsDeducted, monthlyTDS) {
            const monthlyTDSTable = document.getElementById('monthly_tds_table');
            monthlyTDSTable.innerHTML = '';
            const months = ['April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December', 'January', 'February', 'March'];
            let remainingTax = Math.max(0, annualTaxLiability);

            for (let i = 0; i < 12; i++) {
                const row = document.createElement('tr');
                const monthCell = document.createElement('td');
                const tdsDeductedCell = document.createElement('td');
                const tdsLiabilityCell = document.createElement('td');

                monthCell.textContent = months[i];
                tdsDeductedCell.textContent = formatCurrency(tdsDeducted[i]);

                let thisMonthTDS = tdsDeducted[i] > 0 ? 0 : monthlyTDS;
                if (i === 11) thisMonthTDS = remainingTax;
                thisMonthTDS = Math.max(0, Math.min(thisMonthTDS, remainingTax));
                remainingTax = Math.max(0, remainingTax - thisMonthTDS);

                tdsLiabilityCell.textContent = formatCurrency(thisMonthTDS);

                row.appendChild(monthCell);
                row.appendChild(tdsDeductedCell);
                row.appendChild(tdsLiabilityCell);
                monthlyTDSTable.appendChild(row);
            }
        }

        // Generate TDS Chart
        function generateTDSChart(annualTaxLiability, tdsDeducted, monthlyTDS) {
            const months = ['Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar'];
            const tdsData = [];
            let remainingTax = Math.max(0, annualTaxLiability);

            for (let i = 0; i < 12; i++) {
                let thisMonthTDS = tdsDeducted[i] > 0 ? tdsDeducted[i] : (i === 11 ? remainingTax : monthlyTDS);
                thisMonthTDS = Math.max(0, Math.min(thisMonthTDS, remainingTax));
                tdsData.push(thisMonthTDS);
                remainingTax = Math.max(0, remainingTax - thisMonthTDS);
            }

            const ctx = document.getElementById('tds-chart').getContext('2d');
            if (window.tdsChart instanceof Chart) window.tdsChart.destroy();
            window.tdsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Monthly TDS (₹)',
                        data: tdsData,
                        backgroundColor: 'rgba(26, 115, 232, 0.7)',
                        borderColor: 'rgba(26, 115, 232, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, ticks: { callback: value => '₹' + formatCurrency(value) } } },
                    plugins: {
                        tooltip: { callbacks: { label: context => '₹' + formatCurrency(context.raw) } },
                        legend: { display: false }
                    }
                }
            });
        }

        // Format Currency
        function formatCurrency(value) {
            const parts = Math.max(0, value).toFixed(2).split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            return parts.join('.');
        }
    </script>
</body>
</html>
